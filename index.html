<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SmartComp ‚Äî C/C++ Online Compiler</title>
  <meta name="description" content="SmartComp: glassmorphism C & C++ online compiler with Monaco editor, console input in output panel, and error highlighting."/>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: 12, 14, 22;
      --glass: 255,255,255;
      --accent: 82, 156, 255;
      --accent2: 181, 108, 255;
      --ok: 34,197,94;
      --warn: 234,179,8;
      --err: 239,68,68;
    }
    *{ box-sizing: border-box }
    html,body{ height:100% }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';
      color: #e6e8ef;
      background: radial-gradient(1200px 800px at 15% 10%, rgba(var(--accent),0.15), transparent 60%),
                  radial-gradient(1000px 700px at 85% 20%, rgba(var(--accent2),0.18), transparent 55%),
                  linear-gradient(180deg, rgba(10,12,20,1), rgba(8,10,16,1));
    }
    .nav{
      position: sticky; top:0; z-index:50;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding: 14px 18px;
      backdrop-filter: saturate(180%) blur(14px);
      background: linear-gradient(120deg, rgba(var(--glass),0.06), rgba(var(--glass),0.03));
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .brand{ display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:0.3px; }
    .logo{ width:36px; height:36px; border-radius:12px; background: linear-gradient(135deg, rgba(var(--accent),0.9), rgba(var(--accent2),0.9)); box-shadow: 0 8px 24px rgba(0,0,0,0.25), inset 0 0 18px rgba(255,255,255,0.22); position: relative; overflow:hidden; }
    .logo:after{ content:""; position:absolute; inset:0; background: radial-gradient(120% 80% at 80% -20%, rgba(255,255,255,0.4), transparent 38%); }
    .controls{ display:flex; gap:10px; flex-wrap:wrap; align-items:center }
    .pill{ display:inline-flex; align-items:center; gap:8px; height:38px; padding:0 12px; border-radius: 14px; border:1px solid rgba(255,255,255,0.08); background: linear-gradient(180deg, rgba(var(--glass),0.08), rgba(var(--glass),0.04)); backdrop-filter: blur(12px); }
    select, button, input{ appearance:none; color:#e8ebf5; font:inherit; height:34px; border:none; outline:none; background: transparent; padding:0 6px; border-radius:10px; }
    button.primary{ height:40px; padding:0 14px; border-radius:12px; font-weight:700; background: linear-gradient(135deg, rgba(var(--accent),0.9), rgba(var(--accent2),0.9)); box-shadow: 0 10px 26px rgba(59,130,246,0.25); transition: transform .08s ease, box-shadow .2s ease; border:1px solid rgba(255,255,255,0.18); }
    button.primary:hover{ transform: translateY(-1px); box-shadow: 0 14px 34px rgba(59,130,246,0.35) }
    button.ghost{ height:40px; padding:0 12px; border-radius:12px; font-weight:600; border:1px solid rgba(255,255,255,0.14) }
    button.small{ height:34px; font-weight:600; border:1px solid rgba(255,255,255,0.14); border-radius:10px }
    .grid{ display:grid; grid-template-columns: 1.3fr 0.9fr; gap:16px; padding:16px; align-items:stretch; }
    .card{ position:relative; border-radius:18px; padding:12px; overflow:hidden; border: 1px solid rgba(255,255,255,0.10); background: linear-gradient(180deg, rgba(var(--glass),0.08), rgba(var(--glass),0.035)); box-shadow: 0 12px 50px rgba(0,0,0,0.30), inset 0 1px 0 rgba(255,255,255,0.05); backdrop-filter: blur(14px) saturate(130%); min-height: 360px; }
    .card-header{ display:flex; justify-content:space-between; align-items:center; padding:8px 10px 12px; }
    .card-title{ font-weight:800; letter-spacing:0.3px; opacity:0.95 }
    .badge{ font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.14); background: linear-gradient(180deg, rgba(var(--glass),0.10), rgba(var(--glass),0.06)); }
    #editor{ height: 64vh; min-height: 380px; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,0.08) }
    .tabs{ display:flex; gap:8px; padding:6px; }
    .tab{ padding:8px 12px; border-radius:10px; font-weight:600; border:1px solid rgba(255,255,255,0.10); background: linear-gradient(180deg, rgba(var(--glass),0.09), rgba(var(--glass),0.05)); cursor:pointer; opacity:0.85 }
    .tab.active{ opacity:1; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.15) }
    pre.output{ white-space: pre-wrap; word-break: break-word; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: rgba(0,0,0,0.35); padding:12px; border-radius:10px; min-height: 220px; border:1px solid rgba(255,255,255,0.08); }
    .split{ display:flex; flex-direction:column; gap:10px }
    .errors{ display:flex; flex-direction:column; gap:8px; max-height: 280px; overflow:auto; }
    .err-item{ display:flex; gap:10px; align-items:flex-start; padding:8px 10px; border-radius:10px; background: linear-gradient(180deg, rgba(255,0,0,0.06), rgba(255,255,255,0.03)); border:1px solid rgba(255,255,255,0.10); cursor:pointer; }
    .err-dot{ width:10px; height:10px; border-radius:999px; background: rgb(var(--err)); margin-top:6px }
    .warn-dot{ background: rgb(var(--warn)) }
    .muted{ opacity:0.7 }

    /* Terminal-like input area inside output panel */
    .term{ display:flex; flex-direction:column; gap:8px }
    .term-in{ border:1px solid rgba(255,255,255,0.08); background: rgba(0,0,0,0.45); border-radius:10px; padding:10px; min-height:46px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; outline:none; }
    .term-in:empty:before{ content: attr(data-placeholder); opacity:0.6 }
    .term-hint{ font-size:12px; opacity:0.75 }

    .footer{ text-align:center; opacity:0.75; padding:10px 0 26px }

    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } #editor{ height: 52vh } }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="brand">
      <div class="logo" aria-hidden="false">  üï∏Ô∏èüï∑Ô∏è </div>
      <div>
        <div style="font-size:18px">SmartComp</div>
        <div style="font-size:11px; opacity:0.7; font-weight:600; letter-spacing:0.3px">C / C++ Online Compiler</div>
      </div>
    </div>
    <div class="controls">
      <div class="pill">
        <span class="muted" style="font-size:12px">Language</span>
        <select id="lang">
          <option value="c">C (gcc)</option>
          <option value="cpp">C++ (g++)</option>
        </select>
      </div>
      <div class="pill">
        <span class="muted" style="font-size:12px">Theme</span>
        <select id="theme">
          <option value="vs-dark">Dark</option>
          <option value="vs">Light</option>
          <option value="hc-black">High Contrast</option>
        </select>
      </div>
      <button class="ghost" id="samplesBtn" title="Insert starter code">Samples</button>
      <button class="primary" id="runBtn">‚ñ∂ Run</button>
    </div>
  </nav>

  <main class="grid">
    <section class="card">
      <div class="card-header">
        <div class="card-title">Editor <span class="badge" id="statusBadge">Ready</span></div>
        <div style="display:flex; gap:8px">
          <button class="small" id="fmtBtn" title="Format code (basic)">Format</button>
          <button class="small" id="saveBtn" title="Save to browser">Save</button>
          <button class="small" id="clearBtn" title="Clear editor">Clear</button>
        </div>
      </div>
      <div id="editor" aria-label="Code editor"></div>
    </section>

    <section class="card split">
      <div class="card-header">
        <div class="card-title">Console</div>
        <div class="tabs">
          <div class="tab active" data-tab="out">Program Output</div>
          <div class="tab" data-tab="err">Compiler Messages</div>
        </div>
      </div>
      <div id="panel-out">
        <div class="term">
          <pre class="output" id="stdout" aria-live="polite">Output will appear here‚Ä¶</pre>
          <div id="stdinTerm" class="term-in" contenteditable="true" spellcheck="false" data-placeholder="Type input here (this will be sent to your program on next Run). Use Shift+Enter for new line, Ctrl+Enter to Run."></div>
          <div class="term-hint">Tip: Interactive stdin during runtime isn't supported by the remote runner. Put all inputs here (each on a new line) and press <strong>Ctrl+Enter</strong> or click <strong>Run</strong>.</div>
          <div style="display:flex; gap:8px; justify-content:flex-end;">
            <button class="small" id="copyOut">Copy Output</button>
            <button class="small" id="clearOut">Clear Output</button>
            <button class="small" id="clearIn">Clear Input</button>
          </div>
        </div>
      </div>
      <div id="panel-err" style="display:none">
        <div class="errors" id="errors"></div>
        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px">
          <button class="small" id="clearErr">Clear</button>
        </div>
      </div>
    </section>
  </main>

  <div class="footer">SH13:Cybercorp‚Ñ¢Ô∏è ‚ô•Ô∏è ‚Äî SmartComp C,C++ Compiler  ‚Ä¢ By - Shan Pandey </div>

  <!-- Monaco Editor CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
  ;(function(){
    const PISTON_URL = 'https://emkc.org/api/v2/piston/execute';
    const $ = (q)=>document.querySelector(q);
    const $$ = (q)=>Array.from(document.querySelectorAll(q));

    const langSel = $('#lang');
    const themeSel = $('#theme');
    const runBtn = $('#runBtn');
    const fmtBtn = $('#fmtBtn');
    const clearBtn = $('#clearBtn');
    const saveBtn = $('#saveBtn');
    const samplesBtn = $('#samplesBtn');
    const statusBadge = $('#statusBadge');
    const stdout = $('#stdout');
    const errorsBox = $('#errors');
    const copyOut = $('#copyOut');
    const clearOut = $('#clearOut');
    const clearErr = $('#clearErr');
    const clearIn = $('#clearIn');
    const stdinTerm = $('#stdinTerm');

    let editor, monacoRef;

    // Monaco boot
    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' } });
    require(['vs/editor/editor.main'], function(){
      monacoRef = monaco;
      editor = monaco.editor.create(document.getElementById('editor'), {
        value: getSaved() || samples.c,
        language: 'cpp',
        theme: themeSel.value,
        automaticLayout: true,
        fontLigatures: true,
        fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',
        fontSize: 14,
        minimap: { enabled: false },
        scrollBeyondLastLine: false,
        smoothScrolling: true,
        tabSize: 2,
        renderWhitespace: 'selection'
      });
      // language switch
      langSel.addEventListener('change', ()=>{
        const ln = langSel.value;
        const model = editor.getModel();
        const next = 'cpp'; // use C++ highlighter for both
        monaco.editor.setModelLanguage(model, next);
        if(!getSaved()) editor.setValue(samples[ln]);
        setBadge('Ready');
      });
      // theme switch
      themeSel.addEventListener('change', ()=> monaco.editor.setTheme(themeSel.value));
      // tabs
      $$('.tab').forEach(t=>t.addEventListener('click', ()=>{
        $$('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const key = t.getAttribute('data-tab');
        $('#panel-out').style.display = key==='out' ? 'block':'none';
        $('#panel-err').style.display = key==='err' ? 'block':'none';
      }));
      // buttons
      runBtn.addEventListener('click', compileAndRun);
      fmtBtn.addEventListener('click', basicFormat);
      clearBtn.addEventListener('click', ()=>{ editor.setValue(''); clearMarkers(); });
      saveBtn.addEventListener('click', saveCode);
      samplesBtn.addEventListener('click', ()=>{ editor.setValue(samples[langSel.value]); setBadge('Sample inserted'); });
      copyOut.addEventListener('click', ()=>{ navigator.clipboard.writeText(stdout.innerText||'').then(()=> setBadge('Output copied')); });
      clearOut.addEventListener('click', ()=> stdout.textContent = '');
      clearErr.addEventListener('click', ()=>{ errorsBox.innerHTML=''; clearMarkers(); });
      clearIn.addEventListener('click', ()=>{ stdinTerm.textContent=''; stdinTerm.focus(); });

      // Terminal input shortcuts
      stdinTerm.addEventListener('keydown', (e)=>{
        if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ e.preventDefault(); compileAndRun(); }
        if(e.key==='Tab'){ e.preventDefault(); document.execCommand('insertText', false, '\t'); }
      });

      // auto-save
      editor.onDidChangeModelContent(()=>{ localStorage.setItem(storageKey(), editor.getValue()); })
    });

    function storageKey(){ return `smartcomp:${langSel.value}` }
    function getSaved(){ return localStorage.getItem(storageKey()) }
    function saveCode(){ localStorage.setItem(storageKey(), editor.getValue()); setBadge('Saved locally') }

    function setBadge(text){ statusBadge.textContent = text; setTimeout(()=> statusBadge.textContent='Ready', 1800); }

    function basicFormat(){
      const lines = editor.getValue().split('\n').map(l=> l.replace(/\s+$/,''));
      let txt = lines.join('\n');
      if(!/\n$/.test(txt)) txt += '\n';
      const pos = editor.getPosition();
      editor.setValue(txt);
      editor.setPosition(pos);
      setBadge('Formatted');
    }

    async function compileAndRun(){
      clearMarkers();
      const stdinText = stdinTerm.innerText.replace(/\u00A0/g,' '); // normalize NBSP
      stdout.textContent = '‚è≥ Compiling & running‚Ä¶';
      errorsBox.innerHTML='';
      runBtn.disabled = true; setBadge('Working‚Ä¶');
      try{
        const lang = langSel.value === 'cpp' ? 'cpp' : 'c';
        const name = lang==='c' ? 'main.c' : 'main.cpp';
        const code = editor.getValue();

        const body = {
          language: lang === 'c' ? 'c' : 'cpp',
          version: '*',
          files: [{ name, content: code }],
          stdin: stdinText,
          compile_timeout: 10000,
          run_timeout: 5000,
          args: []
        };

        const res = await fetch(PISTON_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        if(!res.ok){ throw new Error('Remote runner unavailable ('+res.status+')') }
        const out = await res.json();

        const compStderr = (out.compile && out.compile.stderr) ? out.compile.stderr : '';
        const compStdout = (out.compile && out.compile.stdout) ? out.compile.stdout : '';
        const runStdout  = (out.run && out.run.stdout) ? out.run.stdout : '';
        const runStderr  = (out.run && out.run.stderr) ? out.run.stderr : '';

        const combinedOut = [compStdout, runStdout].filter(Boolean).join('\n');
        const combinedErr = [compStderr, runStderr].filter(Boolean).join('\n');

        stdout.textContent = combinedOut || (combinedErr ? '' : '‚úì Done (no output)');

        if(combinedErr){
          const items = parseDiagnostics(combinedErr);
          if(items.length){
            applyMarkers(items);
            renderErrors(items);
            document.querySelector('.tab[data-tab="err"]').click();
          } else {
            const div = document.createElement('div');
            div.className = 'err-item'; div.innerHTML = `<div class="err-dot"></div><div><div><strong>Build</strong></div><div class="muted">`+escapeHtml(combinedErr)+`</div></div>`;
            errorsBox.appendChild(div);
            document.querySelector('.tab[data-tab="err"]').click();
          }
        }
        setBadge('Done');
      }catch(err){
        stdout.textContent = '';
        const div = document.createElement('div');
        div.className = 'err-item';
        div.innerHTML = `<div class="err-dot"></div><div><div><strong>Network</strong></div><div class="muted">${escapeHtml(err.message||String(err))}</div></div>`;
        errorsBox.appendChild(div);
        document.querySelector('.tab[data-tab="err"]').click();
        setBadge('Error');
      } finally {
        runBtn.disabled = false;
      }
    }

    function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])) }

    function parseDiagnostics(text){
      const lines = text.split(/\r?\n/);
      const items = [];
      const re = /^(.*?):(\d+):(\d+)?\s*:\s*(fatal error|error|warning|note)\s*:\s*(.*)$/;
      for(const ln of lines){
        const m = ln.match(re);
        if(m){
          const line = parseInt(m[2],10);
          const col  = m[3] ? parseInt(m[3],10) : 1;
          const severity = m[4];
          const msg = m[5];
          items.push({ line, col, endCol: col+1, severity, message: msg, raw: ln });
        }
      }
      return items;
    }

    function applyMarkers(items){
      if(!monacoRef) return;
      const markers = items.map(it=>({
        startLineNumber: it.line,
        startColumn: it.col,
        endLineNumber: it.line,
        endColumn: it.endCol || it.col+1,
        message: it.message,
        severity: it.severity === 'warning' || it.severity==='note' ? monacoRef.MarkerSeverity.Warning : monacoRef.MarkerSeverity.Error
      }))
      monacoRef.editor.setModelMarkers(editor.getModel(), 'compiler', markers);
      const decorations = items.map(it=>({ range: new monacoRef.Range(it.line,1,it.line,1), options: { isWholeLine:true, className:'line-hl' } }));
      editor.__decorations = editor.deltaDecorations(editor.__decorations||[], decorations);
    }

    function clearMarkers(){ if(!monacoRef || !editor) return; monacoRef.editor.setModelMarkers(editor.getModel(), 'compiler', []); if(editor.__decorations) editor.deltaDecorations(editor.__decorations, []); }

    function renderErrors(items){
      errorsBox.innerHTML = '';
      for(const it of items){
        const node = document.createElement('div');
        node.className = 'err-item';
        const dotCls = (it.severity==='warning'||it.severity==='note') ? 'warn-dot' : '';
        node.innerHTML = `
          <div class="err-dot ${dotCls}"></div>
          <div>
            <div><strong>${it.severity.toUpperCase()}</strong> at line ${it.line}, col ${it.col}</div>
            <div class="muted">${escapeHtml(it.message)}</div>
          </div>`;
        node.addEventListener('click', ()=>{
          editor.revealLineInCenter(it.line);
          editor.setPosition({lineNumber: it.line, column: it.col});
          editor.focus();
        });
        errorsBox.appendChild(node);
      }
    }

    const samples = {
      c: `#include <stdio.h>\nint main(){\n  int a,b;\n  if(scanf("%d %d", &a,&b)!=2) return 0;\n  printf("Sum = %d\\n", a+b);\n  return 0;\n}\n`,
      cpp: `#include <bits/stdc++.h>\nusing namespace std;\nint main(){\n  ios::sync_with_stdio(false); cin.tie(nullptr);\n  long long a,b; if(!(cin>>a>>b)) return 0;\n  cout << (a+b) << "\\n";\n  return 0;\n}\n`
    };

    const style = document.createElement('style');
    style.textContent = `.line-hl { background: linear-gradient(90deg, rgba(239,68,68,0.10), rgba(239,68,68,0.00)); }`;
    document.head.appendChild(style);
  })();
  </script>
</body>
</html>
